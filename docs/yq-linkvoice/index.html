<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>linkvoice · AliOS-Things</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="随着AI技术的进步，智能语音开始将人机交互从手+眼睛的传统模式中解放出来。带给人们更便捷、更风趣、更有人情味的体验，让被操作对象变得不再只是一个死板的工具，而更像是一个有生命的助理。“帮我打开空调”，“明天上班需要带伞吗”，“帮我冲100块钱话费”…在万物互联的时代，你的所有需求只需要一句话便能实现。"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="linkvoice · AliOS-Things"/><meta property="og:type" content="website"/><meta property="og:url" content="https://your-docusaurus-test-site.com/index.html"/><meta property="og:description" content="随着AI技术的进步，智能语音开始将人机交互从手+眼睛的传统模式中解放出来。带给人们更便捷、更风趣、更有人情味的体验，让被操作对象变得不再只是一个死板的工具，而更像是一个有生命的助理。“帮我打开空调”，“明天上班需要带伞吗”，“帮我冲100块钱话费”…在万物互联的时代，你的所有需求只需要一句话便能实现。"/><meta property="og:image" content="https://your-docusaurus-test-site.com/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://your-docusaurus-test-site.com/img/docusaurus.png"/><link rel="shortcut icon" href="/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><h2 class="headerTitle">AliOS-Things</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/quickstart" target="_self">Docs</a></li><li class=""><a href="/docs/quickstart" target="_self">FAQ</a></li><li class=""><a href="/docs/contributors" target="_self">Contributors</a></li><li class=""><a href="/help" target="_self">Help</a></li><li class=""><a href="https://github.com/alibaba/AliOS-Things" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docMainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">linkvoice</h1></header><article><div><span><p>随着AI技术的进步，智能语音开始将人机交互从手+眼睛的传统模式中解放出来。带给人们更便捷、更风趣、更有人情味的体验，让被操作对象变得不再只是一个死板的工具，而更像是一个有生命的助理。“帮我打开空调”，“明天上班需要带伞吗”，“帮我冲100块钱话费”…在万物互联的时代，你的所有需求只需要一句话便能实现。
AliOS Things 集成的Link Voice SDK即可实现智能语音交互。</p>
<h1><a class="anchor" aria-hidden="true" id="关于阿里智能语音服务"></a><a href="#关于阿里智能语音服务" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于阿里智能语音服务</h1>
<p>阿里智能语音服务为设备提供语音交互能力、丰富的音乐内容、智能家居控制等，并可进行专有设备技能定制（如：语音操控跑步机、按摩椅等设备）。包括：</p>
<ul>
<li>通用服务：搜歌、搜栏目、搜电台、问天气、百科、四则运算等；</li>
<li>阿里服务：控制智能家居、充值手机费、天猫超市购物、查询电费等 （需接入账号体系，可参考SDS接入）；</li>
<li>私有服务：操控设备、售后电话查询等 （需要技能定制，签约时请提供产品需求）。</li>
</ul>
<h1><a class="anchor" aria-hidden="true" id="功能集成"></a><a href="#功能集成" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>功能集成</h1>
<p>设备接入阿里语音服务，需要集成Alink SDK和Link-Voice SDK，其中Alink SDK为设备提供接入阿里IoT平台的连接、账号体系、配网、OTA等能力，而Link-Voice SDK为设备提供阿里智能语音服务。设备首先要集成了Alink SDK成为SDS平台的一个设备，才能通过集成Link-Voice SDK使用阿里智能语音服务。
Link-Voice SDK除了依赖Alink为设备完成平台接入设备管理外，还需要表格所列模块完成相应工作。其中websockets用来进行语音数据的交互；opus完成语音录制的PCM格式到opus格式的转换（服务端只接收opus格式）；cjson用来做json解析；mbedtls为alink和websockets的底层连接进行加密，为其数据传输提供安全保障。
<img src="https://img.alicdn.com/tfs/TB1WsGwaKOSBuNjy0FdXXbDnVXa-648-290.png" alt="依赖组件"></p>
<p>而目前AliOS Things已完成以上表格所有模块的移植适配工作并将其集成进来，所以我们直接使用AliOS Things便可完成愉快的智能语音开发。主mcu性能建议：</p>
<ul>
<li>Flash&gt;=512KB</li>
<li>RAM&gt;=200KB</li>
<li>CPU&gt;=180Mhz</li>
</ul>
<p>#单次语音识别流程图
简化缓冲处理等细节：
<img src="https://yqfile.alicdn.com/c2edf4f6d51b2fef4f4ea67a08b1d32ab2bd4e43.png" alt="_19_"></p>
<h1><a class="anchor" aria-hidden="true" id="开发平台准备"></a><a href="#开发平台准备" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>开发平台准备</h1>
<p>按理满足功能集成章节性能要求，并带音频录制及播放功能的开发板即可。前提是需要完成AliOS Tings的移植适配工作。本文以全志xr871evb（已完成OS适配）为例进行介绍。
本平台资源：</p>
<ul>
<li>cpu:192Mhz cortext-M4f</li>
<li>RAM：448KB（部分硬件相关code需要加载到ram中运行，实际可用约280KB）</li>
<li>FLASH：2MB SPI FLASH</li>
</ul>
<h1><a class="anchor" aria-hidden="true" id="环境搭建及代码编译"></a><a href="#环境搭建及代码编译" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>环境搭建及代码编译</h1>
<p>先搭建AliOS开发环境（以linux为例）：
AliOS-Things-Linux-Environment-Setup</p>
<p>然后从github阿里官方开源库下载最新版本的AliOS Things源码（<a href="https://github.com/alibaba/AliOS-Things">https://github.com/alibaba/AliOS-Things</a>）：
以linux下开发为例：</p>
<pre><code class="hljs">git clone git@github.com:alibaba/AliOS-Things.git
</code></pre>
<p>切换到主分支：</p>
<pre><code class="hljs">git checkout master
</code></pre>
<p>建议再在主分支上新建一个自己的开发分支：</p>
<pre><code class="hljs">git checkout –b dev-xxx(yourname):
</code></pre>
<p>到目前为止环境也安装好了，代码也准备完毕，只待编译及烧录测试。
编译link-voice测试例程：</p>
<pre><code class="hljs">aos make linkvoiceapp@xr871evb xr871=1
</code></pre>
<p>代码烧入：</p>
<pre><code class="hljs">cd platform/mcu/xr871/tools/
</code></pre>
<p>修改串口配置：</p>
<pre><code class="hljs">vim settings.ini 
</code></pre>
<p>将串口改成你板子的串口号，可ls /dev/tty*查看，保存退出。
<img src="https://img.alicdn.com/tfs/TB1HRuoaL9TBuNjy0FcXXbeiFXa-865-728.png" alt="uart setting">
代码烧写，先将全志开发板启动选择拨码开关拨至NO位置，如同所示：
<img src="https://img.alicdn.com/tfs/TB1p2KkaMmTBuNjy1XbXXaMrVXa-865-454.png" alt="flash setting">
然后执行</p>
<pre><code class="hljs">./phoenixMC_linux  开始进行代码烧写，烧写完成后再将拨码开关拨回靠串口位置，重启。
</code></pre>
<p>打开minicom或其他串口工具监视设备输入信息，波特率115200。
功能演示：
初次上电后先进行配网：</p>
<pre><code class="hljs">netmgr connect ssid psswd
</code></pre>
<p>其中ssid和psswd分别替换为你无线网络名及密码。
由于没有加本地关键词识别功能，所以现在没次对话需要按键触发。
根据终端提示，待网络连接后，出现以下提示时：
<img src="https://img.alicdn.com/tfs/TB1YzEicWmWBuNjy1XaXXXCbXXa-1726-96.png" alt="press key">
按按键2（AK2）触发语音识别功能。
<img src="https://img.alicdn.com/tfs/TB1o0ataQyWBuNjy0FpXXassXXa-865-199.png" alt="talking">
此时对着开发板说话，语音数据被编码、上传到云端、识别成功后返回相应信息，识别失败亦有相应提示。</p>
<p>示例：
1:明天上班需要带伞吗？
2.给我讲个鬼故事。
3.推荐一部悬疑电影。
4.把空调打开。</p>
<p>以下为一个小的演示视频：
<a href="http://v.youku.com/v_show/id_XMzQ1NjQ4MjIyOA==.html?spm=a2h3j.8428770.3416059.1">http://v.youku.com/v_show/id_XMzQ1NjQ4MjIyOA==.html?spm=a2h3j.8428770.3416059.1</a></p>
<h1><a class="anchor" aria-hidden="true" id="api介绍"></a><a href="#api介绍" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API介绍</h1>
<h2><a class="anchor" aria-hidden="true" id="1-初始化"></a><a href="#1-初始化" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1）初始化</h2>
<p><code>int pal_init(const struct pal_config *config);</code></p>
<ul>
<li>说明： SDK初始化，只需调用一次。</li>
<li>入参：<code>config</code>结构体向SDK传递必须的参数</li>
<li>返回：0成功；-1失败</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="2-销毁"></a><a href="#2-销毁" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2）销毁</h2>
<p><code>void pal_destroy();</code></p>
<ul>
<li>说明：SDK销毁，释放资源。</li>
<li>入参：无</li>
<li>返回：无</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="3-获取sdk版本"></a><a href="#3-获取sdk版本" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3）获取SDK版本</h2>
<p><code>int pal_version();</code></p>
<ul>
<li>说明：返回SDK的版本号</li>
<li>入参：无</li>
<li>返回：SDK版本号</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="4-设置日志级别"></a><a href="#4-设置日志级别" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4）设置日志级别</h2>
<p><code>void pal_set_log_level(int level);</code></p>
<ul>
<li>说明：设置SDK的日志级别。调试阶段可设置为PAL_LOG_LEVEL_DEBUG方便调试问题，调试稳定之后上线前把日志级别设置为PAL_LOG_LEVEL_ERROR。</li>
<li>入参：<code>level</code>为SDK的日志级别</li>
<li>返回：无</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="5-设置环境"></a><a href="#5-设置环境" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5）设置环境</h2>
<p><code>void pal_set_env(int env);</code></p>
<ul>
<li>说明：设置SDK的环境，默认是PAL_ENV_RELEASE，在厂商外部环境下可以连接阿里线上环境。厂商无需使用这个接口。</li>
<li>入参：<code>env</code>为SDK的环境</li>
<li>返回： 无</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="6-厂商播放器向sdk上报消息"></a><a href="#6-厂商播放器向sdk上报消息" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6）厂商播放器向SDK上报消息</h2>
<p><code>int pal_notify_msg(const char *msg);</code></p>
<ul>
<li>说明：厂商的播放器的状态或者按键事件需要按照<code>Link_Voice_SDK_播控协议_v1.0.0.xlsx</code>定义的json格式上报给SDK与上层应用同步状态。</li>
<li>入参：<code>msg</code>为厂商播放器需要向SDK传递的事件消息</li>
<li>返回：0成功；-1失败</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="7-厂商播放器通过sdk透传alink消息"></a><a href="#7-厂商播放器通过sdk透传alink消息" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7）厂商播放器通过SDK透传ALink消息</h2>
<p><code>int pal_post_alink_msg(const char *msg);</code></p>
<ul>
<li>说明：SDK初始化过程会把ALink进行初始化，与阿里平台保持物联长连接，厂商设备需要上报给ALink的消息可通过该接口上报，SDK对该消息进行透传上报给ALink服务端。</li>
<li>入参：<code>msg</code>为厂商需要通过SDK透传给ALink进行上报的消息，格式按照ALink定义的消息格式</li>
<li>返回：0成功；-1失败</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="8-开始一次语音识别"></a><a href="#8-开始一次语音识别" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8）开始一次语音识别</h2>
<p><code>int pal_asr_start();</code></p>
<ul>
<li>说明：设备通过按键或者远场唤醒触发语音识别时调用。</li>
<li>入参：无</li>
<li>返回：0成功；-1失败；</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="9-发送语音数据"></a><a href="#9-发送语音数据" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9）发送语音数据</h2>
<p><code>int pal_asr_send_buffer(const char *buffer, int buffer_len);</code></p>
<ul>
<li>说明：该接口要在调用pal_asr_start成功了之后调用，发送语音数据。如果是PCM格式的数据，则要求每次640字节。如果返回PAL_VAD_STATUS_STOP则为云端检测到语音结束了，厂商这时候可以调用pal_asr_stop或pal_asr_stop_async来获本次识别结果。</li>
<li>入参：<code>buffer</code>语音数据，<code>buffer_len</code>语音数据长度，字节</li>
<li>返回：返回云端检测到的VAD状态</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="10-结束本次语音识别-同步接口"></a><a href="#10-结束本次语音识别-同步接口" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10）结束本次语音识别（同步接口）</h2>
<p><code>struct pal_rec_result* pal_asr_stop();</code></p>
<ul>
<li>说明：pal_rec_result结构体返回本次语音识别的结果，同步的接口。结构体里的字段status表示本次语音识别的状态；should_restore_player_status表示厂商播放器处理完本次语音识别事件之后是否恢复之前的状态，0是不恢复，1是恢复；asr_result表示ASR识别的文本；task_status表示语音识别任务状态，PAL_REC_TASK_STATUS_END表示单次语音识别会话结束，PAL_REC_TASK_STATUS_WAITING表示多轮对话，应当播完TTS之后自动进入拾音状态，开始一次新的语音识别。</li>
<li>入参：无</li>
<li>返回：语音识别结果的结构体</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="11-结束本次语音识别-异步接口"></a><a href="#11-结束本次语音识别-异步接口" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>11）结束本次语音识别（异步接口）</h2>
<p><code>void pal_asr_stop_async(pal_asr_callback callback, void *user);</code></p>
<ul>
<li>说明：异步返回的接口，功能与pal_asr_stop一样。</li>
<li>入参：<code>callback</code>注册的回调函数，用于返回语音识别结果；<code>user</code>用户自定义指针，在<code>callback</code>中会回传给用户</li>
<li>返回：无</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="12-取消本次语音识别"></a><a href="#12-取消本次语音识别" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>12）取消本次语音识别</h2>
<p><code>void pal_asr_cancel();</code></p>
<ul>
<li>说明：取消本次的语音识别。</li>
<li>入参：无</li>
<li>返回：无</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="13-销毁语音识别结果"></a><a href="#13-销毁语音识别结果" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>13）销毁语音识别结果</h2>
<p><code>void pal_rec_result_destroy(struct pal_rec_result *result);</code></p>
<ul>
<li>说明：pal_asr_stop和pal_asr_stop_async返回的语音识别结果，需要通过该接口来释放资源。</li>
<li>入参：<code>result</code>需要销毁的结果</li>
<li>返回：无</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="14-文本转语音-同步接口"></a><a href="#14-文本转语音-同步接口" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>14）文本转语音（同步接口）</h2>
<p><code>struct pal_rec_result* pal_get_tts(const char *text);</code></p>
<ul>
<li>说明：提供文本转语音的功能。返回的结果pal_rec_result需要通过pal_rec_result_destroy销毁。</li>
<li>入参：<code>text</code>需要转换的文本</li>
<li>返回：返回的结构体，文本转语音的结果在tts字段中，是一个可播放的url。</li>
</ul>
<p>#更多</p>
<p>关于AliOS Things更多信息，请参考<a href="https://github.com/alibaba/AliOS-Things/wiki">https://github.com/alibaba/AliOS-Things/wiki</a>
关于Link Voice的更多信息，请参考<a href="https://iot.aliyun.com/product/voice?spm=a2c2j.8959409.5007732.14.666018deKqxNU7">https://iot.aliyun.com/product/voice?spm=a2c2j.8959409.5007732.14.666018deKqxNU7</a></p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav docOnPageNav"><ul class="toc-headings"><li><a href="#1-初始化">1）初始化</a></li><li><a href="#2-销毁">2）销毁</a></li><li><a href="#3-获取sdk版本">3）获取SDK版本</a></li><li><a href="#4-设置日志级别">4）设置日志级别</a></li><li><a href="#5-设置环境">5）设置环境</a></li><li><a href="#6-厂商播放器向sdk上报消息">6）厂商播放器向SDK上报消息</a></li><li><a href="#7-厂商播放器通过sdk透传alink消息">7）厂商播放器通过SDK透传ALink消息</a></li><li><a href="#8-开始一次语音识别">8）开始一次语音识别</a></li><li><a href="#9-发送语音数据">9）发送语音数据</a></li><li><a href="#10-结束本次语音识别-同步接口">10）结束本次语音识别（同步接口）</a></li><li><a href="#11-结束本次语音识别-异步接口">11）结束本次语音识别（异步接口）</a></li><li><a href="#12-取消本次语音识别">12）取消本次语音识别</a></li><li><a href="#13-销毁语音识别结果">13）销毁语音识别结果</a></li><li><a href="#14-文本转语音-同步接口">14）文本转语音（同步接口）</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/docs/Getting-Started" style="margin:20px"><img src="/img/logo.png" alt="AliOS-Things" width="100"/></a><div><h5>Docs</h5><a href="/docs/en/Getting-Started.html">Getting Started</a><a href="/docs/en/Linkkit-Tutorial.html">Guides</a><a href="/docs/en/api-reference/AliOS-Things-API-Guide.html">API Reference</a></div><div><h5>Community</h5><a href="/en/users.html">dingding</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">WebChart</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Yunqi</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 AliOS-Things</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: 'my-api-key',
                indexName: 'my-index-name',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>