<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>AliOS Things SIG BLE Mesh 搭建指南 · AliOS-Things</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## 硬件准备"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="AliOS Things SIG BLE Mesh 搭建指南 · AliOS-Things"/><meta property="og:type" content="website"/><meta property="og:url" content="https://your-docusaurus-test-site.com/index.html"/><meta property="og:description" content="## 硬件准备"/><meta property="og:image" content="https://your-docusaurus-test-site.com/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://your-docusaurus-test-site.com/img/docusaurus.png"/><link rel="shortcut icon" href="/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><h2 class="headerTitle">AliOS-Things</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/quickstart" target="_self">Docs</a></li><li class=""><a href="/docs/quickstart" target="_self">FAQ</a></li><li class=""><a href="/docs/contributors" target="_self">Contributors</a></li><li class=""><a href="/help" target="_self">Help</a></li><li class=""><a href="https://github.com/alibaba/AliOS-Things" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docMainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">AliOS Things SIG BLE Mesh 搭建指南</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="硬件准备"></a><a href="#硬件准备" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>硬件准备</h2>
<p>Raspberry PI3一块</p>
<p>乐鑫ESP32 Devkitc两块</p>
<p>微雪NRF51822开发板两块</p>
<h2><a class="anchor" aria-hidden="true" id="软件环境搭建"></a><a href="#软件环境搭建" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>软件环境搭建</h2>
<p>目前，我们使用运行在Raspberry PI 3上的Bluez作为provisioner。要在Raspberry PI3上运行Bluez meshctl作为provisioner，需要对Raspberry PI的编译选项进行调整，使能一些安全相关特性，才能够正常运行meshctl。在linux上交叉编译Raspberry PI kernel。</p>
<h3><a class="anchor" aria-hidden="true" id="raspberry-pi-kernel"></a><a href="#raspberry-pi-kernel" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Raspberry PI kernel</h3>
<p>目前，我们使用运行在Raspberry PI 3上的Bluez作为provisioner。要在Raspberry PI3上运行Bluez meshctl作为provisioner，需要对Raspberry PI的编译选项进行调整，使能一些安全相关特性，才能够正常运行meshctl。在linux上交叉编译Raspberry PI kernel。</p>
<p>下载Raspberry PI系统源代码</p>
<p><code>git clone https://github.com/raspberrypi/linux.git</code></p>
<p>设置交叉编译工具链路径。</p>
<pre><code class="hljs">`luwang<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/raspberry-pi/linux</span><span class="hljs-variable">$ </span>export CCPREFIX=<span class="hljs-regexp">/home/luwang</span><span class="hljs-regexp">/raspberry-pi/tools</span><span class="hljs-regexp">/arm-bcm2708/gcc</span>-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf- 
luwang<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/raspberry-pi/linux</span><span class="hljs-variable">$ </span><span class="hljs-variable">${</span>CCPREFIX}gcc -v
Using built-<span class="hljs-keyword">in</span> specs.
COLLECT_GCC=<span class="hljs-regexp">/home/luwang</span><span class="hljs-regexp">/raspberry-pi/tools</span><span class="hljs-regexp">/arm-bcm2708/gcc</span>-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf-gcc
COLLECT_LTO_WRAPPER=<span class="hljs-regexp">/home/luwang</span><span class="hljs-regexp">/raspberry-pi/tools</span><span class="hljs-regexp">/arm-bcm2708/gcc</span>-linaro-arm-linux-gnueabihf-raspbian/bin/../libexec/gcc/arm-linux-gnueabihf/<span class="hljs-number">4.8</span>.<span class="hljs-number">3</span>/lto-wrapper
<span class="hljs-symbol">Target:</span> arm-linux-gnueabihf
Configured <span class="hljs-symbol">with:</span> /cbuild/slaves/oorts/crosstool-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/src/gcc-linaro-<span class="hljs-number">4.8</span>-<span class="hljs-number">2014.01</span>/configure --build=i686-build_pc-linux-gnu --host=i686-build_pc-linux-gnu --target=arm-linux-gnueabihf --prefix=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/install --with-sysroot=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/install/arm-linux-gnueabihf/libc --enable-languages=c,c++,fortran --disable-multilib --enable-multiarch --with-arch=armv6 --with-tune=arm1176jz-s --with-fpu=vfp --with-float=hard --with-pkgversion=<span class="hljs-string">'crosstool-NG linaro-1.13.1-4.8-2014.01 - Linaro GCC 2013.11'</span> --with-bugurl=<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/bugs.launchpad.net/gcc</span>-linaro --enable-__cxa_atexit --enable-libmudflap --enable-libgomp --enable-libssp --with-gmp=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/arm-linux-gnueabihf/build/static --with-mpfr=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/arm-linux-gnueabihf/build/static --with-mpc=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/arm-linux-gnueabihf/build/static --with-isl=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/arm-linux-gnueabihf/build/static --with-cloog=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/arm-linux-gnueabihf/build/static --with-libelf=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/.build/arm-linux-gnueabihf/build/static --enable-threads=posix --disable-libstdcxx-pch --enable-linker-build-id --enable-plugin --enable-gold --with-local-prefix=<span class="hljs-regexp">/cbuild/slaves</span><span class="hljs-regexp">/oorts/crosstool</span>-ng/builds/arm-linux-gnueabihf-raspbian-linux/install/arm-linux-gnueabihf/libc --enable-c99 --enable-long-long --with-float=hard
Thread <span class="hljs-symbol">model:</span> posix
gcc version <span class="hljs-number">4.8</span>.<span class="hljs-number">3</span> <span class="hljs-number">20140106</span> (prerelease) (crosstool-NG linaro-<span class="hljs-number">1.13</span>.<span class="hljs-number">1</span>-<span class="hljs-number">4.8</span>-<span class="hljs-number">2014.01</span> - Linaro GCC <span class="hljs-number">2013.11</span>) 
luwang<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/raspberry-pi/linux</span><span class="hljs-variable">$`</span>
</code></pre>
<p>获取kernel编译文件.config。这里从现有的Raspberry PI上获取内核编译的.config。Raspberry PI上安装的镜像是2017-11-29-raspbian-stretch.img。</p>
<p>在Raspberry PI上输入以下命令，生成内核配置文件</p>
<p><code>sudo modprobe configs</code></p>
<p>在linux机器上拷贝生成的Raspberry PI kernel配置文件，并解压。</p>
<p><code>scp pi@raspberrypi:/proc/config.gz PATH_TO_RASPBERRY_PI/linux gunzip -c config.gz &gt; .config</code></p>
<p>修改配置文件以下配置选项</p>
<pre><code class="hljs">`<span class="hljs-attribute">CONFIG_CRYPTO_CMAC</span>=y
<span class="hljs-attribute">CONFIG_CRYPTO_USER_API</span>=y
<span class="hljs-attribute">CONFIG_CRYPTO_USER_API_HASH</span>=y
<span class="hljs-attribute">CONFIG_CRYPTO_USER_API_SKCIPHER</span>=y`
</code></pre>
<p>编译生成内核</p>
<pre><code class="hljs">`cd PATH_TO_RASPBERRY_PI/linux
<span class="hljs-attribute">ARCH</span>=arm <span class="hljs-attribute">CROSS_COMPILE</span>=<span class="hljs-variable">${CCPREFIX}</span> make`
</code></pre>
<p>生成内核modules</p>
<p><code>ARCH=arm CROSS_COMPILE=${CCPREFIX} INSTALL_MOD_PATH=../modules make modules_install</code></p>
<p>得到以下log信息</p>
<pre><code class="hljs">`  INSTALL sound/soc/codecs/snd-soc-tas5713<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-tpa6130a2<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-wm-adsp<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-wm5102<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-wm8731<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-wm8741<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-wm8804-i2c<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/codecs/snd-soc-wm8804<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/generic/snd-soc-simple-card-utils<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/generic/snd-soc-simple-card<span class="hljs-selector-class">.ko</span>
  INSTALL sound/soc/snd-soc-core<span class="hljs-selector-class">.ko</span>
  INSTALL sound/usb/<span class="hljs-number">6</span>fire/snd-usb-<span class="hljs-number">6</span>fire<span class="hljs-selector-class">.ko</span>
  INSTALL sound/usb/caiaq/snd-usb-caiaq<span class="hljs-selector-class">.ko</span>
  INSTALL sound/usb/misc/snd-ua101<span class="hljs-selector-class">.ko</span>
  INSTALL sound/usb/snd-usb-<span class="hljs-selector-tag">audio</span><span class="hljs-selector-class">.ko</span>
  INSTALL sound/usb/snd-usbmidi-lib<span class="hljs-selector-class">.ko</span>
  INSTALL .modules/lib/firmware/emi26/loader<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/emi26/firmware<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/emi26/bitstream<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/emi62/loader<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/emi62/bitstream<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/emi62/spdif<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/emi62/midi<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/kaweth/new_code<span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/kaweth/trigger_code<span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/kaweth/new_code_fix<span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/kaweth/trigger_code_fix<span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/ti_3410<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/ti_5052<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/mts_cdma<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/mts_gsm<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/mts_edge<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/edgeport/boot<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/edgeport/boot2<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/edgeport/down<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/edgeport/down2<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/edgeport/down3<span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/whiteheat_loader<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/whiteheat<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/keyspan_pda/keyspan_pda<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/keyspan_pda/xircom_pgs<span class="hljs-selector-class">.fw</span>
  INSTALL .modules/lib/firmware/cpia2/stv0672_vp4<span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/yam/<span class="hljs-number">1200</span><span class="hljs-selector-class">.bin</span>
  INSTALL .modules/lib/firmware/yam/<span class="hljs-number">9600</span><span class="hljs-selector-class">.bin</span>
  DEPMOD  <span class="hljs-number">4.9</span>.<span class="hljs-number">77</span>-v7+
luwang@ubuntu:~/raspberry-pi/linux$ `
</code></pre>
<p>上半部log由于篇幅原因省略。这里记住版本信息是4.9.77-v7+。</p>
<p>在linux机器上，从linux拷贝生成的kernel到Raspberry PI</p>
<p><code>cd PATH_TO_RASPBERRY_PI/linux/arch/arm/boot/zImage pi@RASPBARRY:/tmp/kernel_new.img</code></p>
<p>在linux机器上，从linux拷贝生成的modules到Raspberry PI</p>
<pre><code class="hljs">`cd PATH_TO_RASPBERRY_PI/modules
tar czf modules.tgz *
scp modules.tgz pi<span class="hljs-variable">@RASPBERRY</span><span class="hljs-symbol">:/tmp`</span>
</code></pre>
<p>将拷贝到Raspberry PI上的kernel和modules移动到boot和lib下面</p>
<pre><code class="hljs">`sudo cp /tmp/kernel_new.img /boot
sudo tar zxf /tmp/modules.tgz
sudo cp -rf /tmp/lib<span class="hljs-built_in">/firmware </span>/lib<span class="hljs-built_in">/firmware
</span>sudo cp -rf /tmp/lib/modules /lib/modules`
</code></pre>
<p>在Raspberry PI启动配置文件config.tx，文件最后面加入下面内容，指定从刚生成的kernel_new.img中启动。</p>
<p><code>kernel=kernel_new.img</code></p>
<p>重启Raspberry PI</p>
<p><code>sudo shutdown -r now</code></p>
<p>确认内核信息已经更新为新生成的kernel</p>
<p><code>uname -r 4.9.77-v7+</code></p>
<p>安装后续所需依赖</p>
<pre><code class="hljs">`sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span>
sudo apt-<span class="hljs-built_in">get</span> install -y libusb-<span class="hljs-built_in">dev</span> libdbus<span class="hljs-number">-1</span>-<span class="hljs-built_in">dev</span> libglib2<span class="hljs-number">.0</span>-<span class="hljs-built_in">dev</span> libudev-<span class="hljs-built_in">dev</span> libical-<span class="hljs-built_in">dev</span> libreadline-<span class="hljs-built_in">dev</span> autotools-<span class="hljs-built_in">dev</span> automake libtool`
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="json-c"></a><a href="#json-c" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>json-c</h3>
<p>下载json-c源代码</p>
<p><code>git clone https://github.com/json-c/json-c.git</code></p>
<p>编译并安装</p>
<pre><code class="hljs">`<span class="hljs-keyword">cd</span> PATH_TO_JSON_C
<span class="hljs-keyword">sh</span> autogen.<span class="hljs-keyword">sh</span>
./configure
<span class="hljs-keyword">make</span>
sudo <span class="hljs-keyword">make</span> install`
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="bluez"></a><a href="#bluez" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bluez</h3>
<p>从以下链接下载bluez-5.48.tar.gz，并解压到本地目录</p>
<pre><code class="hljs">`https:<span class="hljs-comment">//git.kernel.org/pub/scm/bluetooth/bluez.git</span>
tar xvf bluez-<span class="hljs-number">5.48</span><span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span>`
</code></pre>
<p>修改mesh gatt在处理数据分段时的逻辑，diff如下</p>
<pre><code class="hljs">`luwang@ubuntu:~/bluez$ git diff mesh/gatt.c
diff <span class="hljs-comment">--git a/mesh/gatt.c b/mesh/gatt.c</span>
index <span class="hljs-number">9116</span>a9d.<span class="hljs-number">.8</span>d564a9 <span class="hljs-number">100644</span>
<span class="hljs-comment">--- a/mesh/gatt.c</span>
+++ b/mesh/gatt.c
@@ <span class="hljs-number">-393</span>,<span class="hljs-number">7</span> +<span class="hljs-number">393</span>,<span class="hljs-number">10</span> @@ static bool pipe_read(struct <span class="hljs-built_in">io</span> *<span class="hljs-built_in">io</span>, bool prov, void *user_data)
                        <span class="hljs-keyword">break</span>;
 
                res = buf;
   -               mesh_gatt_sar(&amp;res, <span class="hljs-built_in">len</span>);
   +               <span class="hljs-built_in">len</span> = mesh_gatt_sar(&amp;res, <span class="hljs-built_in">len</span>);
   +                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span> == <span class="hljs-number">0</span>) {
   +                    <span class="hljs-keyword">break</span>;
   +                }
 
                <span class="hljs-keyword">if</span> (prov)
                        prov_data_ready(node, res, <span class="hljs-built_in">len</span>);`
</code></pre>
<p>编译安装</p>
<pre><code class="hljs">`cd PATH_TO_BLUEZ
./bootstrap
./configure --<span class="hljs-keyword">enable</span>-mesh --<span class="hljs-keyword">enable</span>-<span class="hljs-keyword">debug</span>
<span class="hljs-built_in">make</span>
sudo <span class="hljs-built_in">make</span> install`
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="bluetooth-controller"></a><a href="#bluetooth-controller" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bluetooth controller</h3>
<p>Bluetooth controller使用的是zephyr的bluetooth/hci_uart应用，使用的分支branch是v1.10-branch。</p>
<p>修改串口波特率为115200.</p>
<pre><code class="hljs">`luwang<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:~/zephyr/samples/bluetooth/hci_uart</span><span class="hljs-variable">$ </span>git diff nrf5.conf
diff --git a/samples/bluetooth/hci_uart/nrf5.conf b/samples/bluetooth/hci_uart/nrf5.conf
index <span class="hljs-number">4</span>a507be..<span class="hljs-number">9</span>aea95f <span class="hljs-number">100644</span>
 --- a/samples/bluetooth/hci_uart/nrf5.conf
 +++ b/samples/bluetooth/hci_uart/nrf5.conf
@@ -<span class="hljs-number">4</span>,<span class="hljs-number">7</span> +<span class="hljs-number">4</span>,<span class="hljs-number">7</span> @@ CONFIG_UART_CONSOLE=n
 CONFIG_GPIO=y
 CONFIG_SERIAL=y
 CONFIG_UART_INTERRUPT_DRIVEN=y
 -CONFIG_UART_NRF5_BAUD_RATE=<span class="hljs-number">1000000</span>
 +CONFIG_UART_NRF5_BAUD_RATE=<span class="hljs-number">115200</span>
 CONFIG_UART_NRF5_FLOW_CONTROL=y
 CONFIG_MAIN_STACK_SIZE=<span class="hljs-number">512</span>
 CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=<span class="hljs-number">51</span>`
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="server端和client端应用程序"></a><a href="#server端和client端应用程序" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server端和Client端应用程序</h3>
<p>下载AliOS-Things源代码</p>
<p><code>git clone git@github.com:alibaba/AliOS-Things.git</code></p>
<p>编译生成Server端应用</p>
<pre><code class="hljs">`cd PATH_TO_AOS
aos make bluetooth.blemesh_srv@esp32devkitc hci_h4=<span class="hljs-number">1</span>`
</code></pre>
<p>编译生成Client端应用</p>
<p><code>cd PATH_TO_AOS aos make bluetooth.blemesh_cli@esp32devkitc hci_h4=1</code></p>
<p>将生成的镜像利用esptool烧录到ESP32.</p>
<h2><a class="anchor" aria-hidden="true" id="温度监测网络的搭建"></a><a href="#温度监测网络的搭建" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>温度监测网络的搭建</h2>
<p>温度监测网络包括三种角色，provisioner，server和client。Server是温度信息的发布者，client是温度信息的订阅者。</p>
<h3><a class="anchor" aria-hidden="true" id="provisioning和配置server节点"></a><a href="#provisioning和配置server节点" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Provisioning和配置Server节点</h3>
<p>在Raspberry PI上，运行并进入meshctl命令行</p>
<pre><code class="hljs">`pi@raspberrypi:~/bluez-5.48/mesh $ ./meshctl .
Local<span class="hljs-built_in"> config </span>directory <span class="hljs-keyword">not</span> provided.
  netkeys = 1
  appkeys = 2
  provisioners = 1
On/Off<span class="hljs-built_in"> client </span>model: new binding 0001
[NEW] Controller B8:27:EB:B2:E7:4A raspberrypi [default]
[NEW] Device EC:60:BA:B5:36:D0 AOS Device<span class="hljs-built_in">
Service </span>added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a
Char added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d:
Char added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b:<span class="hljs-built_in">
Service </span>added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service0006`
</code></pre>
<p>server节点上电，并开启发现unprovisioned 设备模式，发现新unprovisioned设备</p>
<pre><code class="hljs">`[meshctl]# discover-unprovisioned on
SetDiscoveryFilter success<span class="hljs-built_in">
Discovery </span>started
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: <span class="hljs-literal">yes</span>
        Mesh Provisioning<span class="hljs-built_in"> Service </span>(00001827-0000-1000-8000-00805f9b34fb)
            Device UUID: dddd0000000000000000000000000000
            OOB: 0000`
</code></pre>
<p>认证该设备</p>
<pre><code class="hljs">`[meshctl]<span class="hljs-comment"># provision dddd</span>
Trying to connect Device EC:60:BA:B5:36:D0 AOS Device
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: no
Connection successful
Services resolved yes
Found matching char: path /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b, uuid 00002adb-0000-1000-8000-00805f9b34fb
Found matching char: path /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d, uuid 00002adc-0000-1000-8000-00805f9b34fb
Start notification on /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d
Characteristic property changed /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d
AcquireNotify success: fd<span class="hljs-number"> 7 </span>MTU 65
Notify for Mesh Provisioning Out Data started
Open-Node: 0x1758dc8
Open-Prov: 0x1757598
Open-Prov: proxy 0x175a1c8
Initiated provisioning
Characteristic property changed /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b
AcquireWrite success: fd<span class="hljs-number"> 8 </span>MTU 65
GATT-TX:    <span class="hljs-number"> 03 </span>00<span class="hljs-number"> 10 </span>
GATT-RX:    <span class="hljs-number"> 03 </span>01<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 00 </span>04<span class="hljs-number"> 00 </span>08<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>
Got provisioning data (12 bytes)
    <span class="hljs-number"> 01 </span>01<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 04 </span>00<span class="hljs-number"> 08 </span>00<span class="hljs-number"> 00 </span>00 
GATT-TX:    <span class="hljs-number"> 03 </span>02<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>
GATT-TX:    <span class="hljs-number"> 03 </span>03<span class="hljs-number"> 09 </span>da d3 a0 1e 4f<span class="hljs-number"> 15 </span>34 3c 1f<span class="hljs-number"> 88 </span>e2 1f<span class="hljs-number"> 93 </span>
GATT-TX:     f6<span class="hljs-number"> 38 </span>9b 8a 2d 3a a0<span class="hljs-number"> 49 </span>7a 0b<span class="hljs-number"> 01 </span>c6 5c<span class="hljs-number"> 61 </span>d9 cc 
GATT-TX:    <span class="hljs-number"> 49 </span>be<span class="hljs-number"> 26 </span>78 5c 5c de c1<span class="hljs-number"> 05 </span>86 6f 5a<span class="hljs-number"> 88 </span>0d<span class="hljs-number"> 93 </span>b8 
GATT-TX:    <span class="hljs-number"> 60 </span>e2<span class="hljs-number"> 77 </span>67 3d<span class="hljs-number"> 72 </span>f4<span class="hljs-number"> 46 </span>b4 5f d3 b1<span class="hljs-number"> 87 </span>53 cd<span class="hljs-number"> 96 </span>
GATT-TX:     fc ce 
GATT-RX:    <span class="hljs-number"> 43 </span>03 d2<span class="hljs-number"> 68 </span>da 6f fe cc f8<span class="hljs-number"> 97 </span>0e<span class="hljs-number"> 99 </span>84 e6 eb<span class="hljs-number"> 93 </span>
GATT-RX:    <span class="hljs-number"> 15 </span>15 aa 1d<span class="hljs-number"> 15 </span>5b 2a f2 e7 1f 4d c1<span class="hljs-number"> 93 </span>51<span class="hljs-number"> 14 </span>29 
GATT-RX:     7e b7<span class="hljs-number"> 75 </span>0c 8d 5a<span class="hljs-number"> 51 </span>c8<span class="hljs-number"> 14 </span>29 8d 3a<span class="hljs-number"> 73 </span>de fa<span class="hljs-number"> 95 </span>
GATT-RX:    <span class="hljs-number"> 09 </span>42 7e 7f 0a be e2 ed e5 ff<span class="hljs-number"> 27 </span>43<span class="hljs-number"> 26 </span>f7 
GATT-RX:     c3 ab 8b ef 6f 
Got provisioning data (65 bytes)
    <span class="hljs-number"> 03 </span>d2<span class="hljs-number"> 68 </span>da 6f fe cc f8<span class="hljs-number"> 97 </span>0e<span class="hljs-number"> 99 </span>84 e6 eb<span class="hljs-number"> 93 </span>15 
    <span class="hljs-number"> 15 </span>aa 1d<span class="hljs-number"> 15 </span>5b 2a f2 e7 1f 4d c1<span class="hljs-number"> 93 </span>51<span class="hljs-number"> 14 </span>29 7e 
     b7<span class="hljs-number"> 75 </span>0c 8d 5a<span class="hljs-number"> 51 </span>c8<span class="hljs-number"> 14 </span>29 8d 3a<span class="hljs-number"> 73 </span>de fa<span class="hljs-number"> 95 </span>09 
    <span class="hljs-number"> 42 </span>7e 7f 0a be e2 ed e5 ff<span class="hljs-number"> 27 </span>43<span class="hljs-number"> 26 </span>f7 ab 8b ef 
     6f 
Request decimal key (0 - 9999)
[AOS 1m[mesh] Enter Numeric key: `
</code></pre>
<p>查看server命令行OOB输出</p>
<pre><code class="hljs">`Initializing<span class="hljs-built_in">..</span>.
Bluetooth initialized<span class="hljs-built_in">
Server
</span>Mesh initialized
attention_on()
OOB Number: 9023
attention_off()`
</code></pre>
<p>在Raspberry PI上键入9023，进行后续provision，后续会打印一长串log</p>
<pre><code class="hljs">`[AOS 1m[mesh] Enter Numeric key: 9023
GATT-TX:    <span class="hljs-number"> 03 </span>05 fe 7f b1<span class="hljs-number"> 04 </span>84 f6 e9 0d 9e c7<span class="hljs-number"> 62 </span>19 6d 1f 
GATT-TX:    <span class="hljs-number"> 03 </span>64 
GATT-RX:    <span class="hljs-number"> 03 </span>05 ca f5 8e<span class="hljs-number"> 55 </span>ff 1d<span class="hljs-number"> 92 </span>86<span class="hljs-number"> 26 </span>fa 8e<span class="hljs-number"> 22 </span>8c<span class="hljs-number"> 33 </span>
GATT-RX:    <span class="hljs-number"> 69 </span>80 
Got provisioning data (17 bytes)
    <span class="hljs-number"> 05 </span>ca f5 8e<span class="hljs-number"> 55 </span>ff 1d<span class="hljs-number"> 92 </span>86<span class="hljs-number"> 26 </span>fa 8e<span class="hljs-number"> 22 </span>8c<span class="hljs-number"> 33 </span>69 
    <span class="hljs-number"> 80 </span>
GATT-TX:    <span class="hljs-number"> 03 </span>06 d6<span class="hljs-number"> 63 </span>cd 7c e6 3b b5 9b 2b a3 f5 3e e6 7c 
GATT-TX:    <span class="hljs-number"> 15 </span>f1 
GATT-RX:    <span class="hljs-number"> 03 </span>06 7a<span class="hljs-number"> 94 </span>aa 7a 3b f3 1c<span class="hljs-number"> 33 </span>92 cf 8a 3c<span class="hljs-number"> 86 </span>ec 
GATT-RX:     9d 0c 
Got provisioning data (17 bytes)
    <span class="hljs-number"> 06 </span>7a<span class="hljs-number"> 94 </span>aa 7a 3b f3 1c<span class="hljs-number"> 33 </span>92 cf 8a 3c<span class="hljs-number"> 86 </span>ec 9d 
     0c 
Confirmation Validated
S-Key    5e ee f5<span class="hljs-number"> 44 </span>72 cc<span class="hljs-number"> 88 </span>c7 3a 9a<span class="hljs-number"> 56 </span>db<span class="hljs-number"> 11 </span>4a d5<span class="hljs-number"> 44 </span>
S-Nonce <span class="hljs-number"> 82 </span>b4 a8 f2 7b 9b<span class="hljs-number"> 76 </span>c7<span class="hljs-number"> 72 </span>8b 3f e2<span class="hljs-number"> 07 </span>
DevKey   f8 a9 4d<span class="hljs-number"> 78 </span>25 b8<span class="hljs-number"> 47 </span>3d 0d 3d<span class="hljs-number"> 20 </span>50<span class="hljs-number"> 91 </span>45 db<span class="hljs-number"> 20 </span>
Data    <span class="hljs-number"> 18 </span>ee d9 c2 a5 6a dd<span class="hljs-number"> 85 </span>04 9f fc 3c<span class="hljs-number"> 59 </span>ad 0e<span class="hljs-number"> 12 </span>
Data    <span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 05 </span>01<span class="hljs-number"> 00 </span>
DataEncrypted + mic  b7 8a f4<span class="hljs-number"> 17 </span>c3 e8<span class="hljs-number"> 05 </span>66<span class="hljs-number"> 84 </span>4d d6 5e<span class="hljs-number"> 22 </span>69<span class="hljs-number"> 73 </span>1c 
DataEncrypted + mic <span class="hljs-number"> 90 </span>10<span class="hljs-number"> 91 </span>8c 5f f7<span class="hljs-number"> 30 </span>55 bf d1 1c<span class="hljs-number"> 29 </span>e9 d6 3e<span class="hljs-number"> 78 </span>
DataEncrypted + mic  f1 
GATT-TX:    <span class="hljs-number"> 03 </span>07 b7 8a f4<span class="hljs-number"> 17 </span>c3 e8<span class="hljs-number"> 05 </span>66<span class="hljs-number"> 84 </span>4d d6 5e<span class="hljs-number"> 22 </span>69 
GATT-TX:    <span class="hljs-number"> 73 </span>1c<span class="hljs-number"> 90 </span>10<span class="hljs-number"> 91 </span>8c 5f f7<span class="hljs-number"> 30 </span>55 bf d1 1c<span class="hljs-number"> 29 </span>e9 d6 
GATT-TX:     3e<span class="hljs-number"> 78 </span>f1 
GATT-RX:    <span class="hljs-number"> 03 </span>08 
Got provisioning data (1 bytes)
    <span class="hljs-number"> 08 </span>
Provision success. Assigned Primary Unicast 0100
Attempting to disconnect from EC:60:BA:B5:36:D0
Characteristic property changed /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d
Write closed
Service added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a
Char added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b:
Char added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d:
Services resolved no
SetDiscoveryFilter success
Discovery started
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: yes

        Mesh Proxy Service (00001828-0000-1000-8000-00805f9b34fb)
        Identity for node 0100
Trying to connect to mesh
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: no
Connection successful
Services resolved yes
Found matching char: path /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b, uuid 00002add-0000-1000-8000-00805f9b34fb
Found matching char: path /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d, uuid 00002ade-0000-1000-8000-00805f9b34fb
Start notification on /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d
Characteristic property changed /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d
AcquireNotify success: fd<span class="hljs-number"> 7 </span>MTU 65
Notify for Mesh Proxy Out Data started
Trying to open mesh session
GATT-RX:    <span class="hljs-number"> 01 </span>01<span class="hljs-number"> 00 </span>d4<span class="hljs-number"> 76 </span>79<span class="hljs-number"> 43 </span>3f db<span class="hljs-number"> 10 </span>4a<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>05 f4 
GATT-RX:     0a<span class="hljs-number"> 41 </span>fa b0 af<span class="hljs-number"> 32 </span>0b 
iv_upd_state = IV_UPD_NORMAL
Mesh session is open
Characteristic property changed /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b
AcquireWrite success: fd<span class="hljs-number"> 8 </span>MTU 65
GATT-TX:    <span class="hljs-number"> 02 </span>f4 9e<span class="hljs-number"> 64 </span>99 fe<span class="hljs-number"> 13 </span>cd c8 9b 0e 1c e5<span class="hljs-number"> 61 </span>82 cc 
GATT-TX:     ab f5<span class="hljs-number"> 83 </span>70 
GATT-TX:    <span class="hljs-number"> 00 </span>f4 b3 a6<span class="hljs-number"> 53 </span>65 b2 a0 cd 7a<span class="hljs-number"> 74 </span>9e<span class="hljs-number"> 95 </span>1d b7<span class="hljs-number"> 13 </span>
GATT-TX:    <span class="hljs-number"> 06 </span>e6<span class="hljs-number"> 48 </span>68 d5 5c 
GATT-RX:    <span class="hljs-number"> 02 </span>f4 e7<span class="hljs-number"> 02 </span>fe d4<span class="hljs-number"> 84 </span>81 a3<span class="hljs-number"> 32 </span>e7 6e 4b 1b<span class="hljs-number"> 74 </span>4a 
GATT-RX:    <span class="hljs-number"> 13 </span>95 f5<span class="hljs-number"> 61 </span>7f eb 
Proxy Whitelist filter length: 0
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 60 </span>4f af f8 ba<span class="hljs-number"> 30 </span>1f a6<span class="hljs-number"> 70 </span>d9 cb 5f<span class="hljs-number"> 12 </span>dd 
GATT-RX:     8b 0b<span class="hljs-number"> 71 </span>6b<span class="hljs-number"> 68 </span>ad<span class="hljs-number"> 00 </span>90<span class="hljs-number"> 07 </span>cf ec e0<span class="hljs-number"> 28 </span>fe 
GATT-RX:    <span class="hljs-number"> 00 </span>f4 2a e4<span class="hljs-number"> 87 </span>bb f8<span class="hljs-number"> 21 </span>34 0d<span class="hljs-number"> 45 </span>4c c3 de 5b e3 
GATT-RX:    <span class="hljs-number"> 21 </span>bb<span class="hljs-number"> 57 </span>9a<span class="hljs-number"> 34 </span>94 5a de 4d e8 ca c8<span class="hljs-number"> 91 </span>cd 
GATT-RX:    <span class="hljs-number"> 00 </span>f4 b7 a0<span class="hljs-number"> 67 </span>ff da<span class="hljs-number"> 92 </span>a3<span class="hljs-number"> 32 </span>4c c2 c2 4e a5 5c 
GATT-RX:     7f<span class="hljs-number"> 12 </span>c7 5f<span class="hljs-number"> 02 </span>bc 0b<span class="hljs-number"> 23 </span>9f<span class="hljs-number"> 13 </span>
    Composition data for node<span class="hljs-number"> 0100 </span>{
  "cid":"0002",
  "pid":"0000",
  "vid":"0000",
  "crpl":"0005",
  "features":{
    "relay":false,
    "proxy":true,
    "friend":false,
    "lpn":false
  },
  "elements":[
    {
      "elementIndex":0,
      "location":"0000",
      "models":[
        "0000",
        "0001",
        "0002",
        "1100"
      ]
    }
  ]
}
GATT-TX:    <span class="hljs-number"> 00 </span>f4 2b d6 e6<span class="hljs-number"> 46 </span>66 5b<span class="hljs-number"> 65 </span>31 1d<span class="hljs-number"> 78 </span>08<span class="hljs-number"> 28 </span>5d<span class="hljs-number"> 16 </span>
GATT-TX:     aa e2<span class="hljs-number"> 97 </span>b6<span class="hljs-number"> 18 </span>84 1f<span class="hljs-number"> 29 </span>7f `
</code></pre>
<p>上述log分为两个阶段，第一个阶段是利用provisioning connection进行provision，第二个阶段是建立mesh proxy connection，后续需要在这个connection上传输网络配置信息。</p>
<p>当上述log完整打印后，server端会打印provision成功完成的信息</p>
<pre><code class="hljs">`Provisioning completed!
<span class="hljs-symbol">Net ID:</span> <span class="hljs-number">0</span>
<span class="hljs-symbol">Unicast addr:</span> <span class="hljs-number">0</span>x0100`
</code></pre>
<p>接下来，是在刚才建立的mesh proxy connection上传递网络配置信息</p>
<p>首先是进入菜单</p>
<pre><code class="hljs">`[AOS Devic-Node-0100]# menu<span class="hljs-built_in"> config
</span>Menu config:
Available commands:
-------------------
target &lt;unicast&gt;                                  <span class="hljs-builtin-name">Set</span> target node <span class="hljs-keyword">to</span> configure
composition-<span class="hljs-builtin-name">get</span> [page_num]                        <span class="hljs-builtin-name">Get</span> Composition Data
netkey-<span class="hljs-builtin-name">add</span> &lt;net_idx&gt;                              <span class="hljs-builtin-name">Add</span><span class="hljs-built_in"> network </span>key
netkey-del &lt;net_idx&gt;                              Delete<span class="hljs-built_in"> network </span>key
appkey-<span class="hljs-builtin-name">add</span> &lt;app_idx&gt;                              <span class="hljs-builtin-name">Add</span> application key
appkey-del &lt;app_idx&gt;                              Delete application key
bind &lt;ele_idx&gt; &lt;app_idx&gt; &lt;mod_id&gt; [cid]           Bind app key <span class="hljs-keyword">to</span> a model
ttl-<span class="hljs-builtin-name">set</span> &lt;ttl&gt;                                     <span class="hljs-builtin-name">Set</span><span class="hljs-built_in"> default </span>TTL
ttl-<span class="hljs-builtin-name">get</span>                                           <span class="hljs-builtin-name">Get</span><span class="hljs-built_in"> default </span>TTL
pub-<span class="hljs-builtin-name">set</span> &lt;ele_addr&gt; &lt;pub_addr&gt; &lt;app_idx&gt; &lt;per (<span class="hljs-keyword">step</span>|res)&gt; &lt;re-xmt (cnt|per)&gt; &lt;mod id&gt; [cid] 
                          <span class="hljs-builtin-name">Set</span> publication
pub-<span class="hljs-builtin-name">get</span> &lt;ele_addr&gt; &lt;model&gt;                        <span class="hljs-builtin-name">Get</span> publication
proxy-<span class="hljs-builtin-name">set</span> &lt;proxy&gt;                                 <span class="hljs-builtin-name">Set</span><span class="hljs-built_in"> proxy </span>state
proxy-<span class="hljs-builtin-name">get</span>                                         <span class="hljs-builtin-name">Get</span><span class="hljs-built_in"> proxy </span>state
ident-<span class="hljs-builtin-name">set</span> &lt;net_idx&gt; &lt;state&gt;                       <span class="hljs-builtin-name">Set</span> node<span class="hljs-built_in"> identity </span>state
ident-<span class="hljs-builtin-name">get</span> &lt;net_idx&gt;                               <span class="hljs-builtin-name">Get</span> node<span class="hljs-built_in"> identity </span>state
relay-<span class="hljs-builtin-name">set</span> &lt;relay&gt; &lt;rexmt count&gt; &lt;rexmt steps&gt;     <span class="hljs-builtin-name">Set</span> relay
relay-<span class="hljs-builtin-name">get</span>                                         <span class="hljs-builtin-name">Get</span> relay
hb-pub-<span class="hljs-builtin-name">set</span> &lt;pub_addr&gt; &lt;count&gt; &lt;period&gt; &lt;features&gt; &lt;net_idx&gt; <span class="hljs-builtin-name">Set</span> heartbeati publish
sub-<span class="hljs-builtin-name">add</span> &lt;ele_addr&gt; &lt;sub_addr&gt; &lt;model id&gt;          Subscription <span class="hljs-builtin-name">add</span>
sub-<span class="hljs-builtin-name">get</span> &lt;ele_addr&gt; &lt;model id&gt;                     Subscription <span class="hljs-builtin-name">get</span>
app-<span class="hljs-builtin-name">get</span> &lt;ele_addr&gt; &lt;model id&gt;                     <span class="hljs-builtin-name">Get</span> App Keys
back                                              Return <span class="hljs-keyword">to</span> main menu
version                                           Display version
quit                                              Quit program
exit                                              Quit program
help                                              Display help about this program`
</code></pre>
<p>选择配置节点，这里可以看到节点ucast addr是0x0100</p>
<pre><code class="hljs">[AOS Devic-<span class="hljs-keyword">Node</span><span class="hljs-title">-0100</span>]<span class="hljs-comment"># target 0100</span>

Configuring <span class="hljs-keyword">node</span> <span class="hljs-title">0100</span>

[config: Target = <span class="hljs-number">0100</span>]<span class="hljs-comment"># target 0100[config: Target = 0100]#</span>
</code></pre>
<p>配置app key</p>
<pre><code class="hljs">`[config: Target = 0100]<span class="hljs-comment"># target 0100[config: Target = 0100]# appkey-add 1</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 e5 ca a3 ba<span class="hljs-number"> 03 </span>7b db 7f a6 aa 7c<span class="hljs-number"> 02 </span>25<span class="hljs-number"> 75 </span>
GATT-TX:     6b 2a cf d4<span class="hljs-number"> 93 </span>0a<span class="hljs-number"> 02 </span>c3 8d<span class="hljs-number"> 22 </span>7d<span class="hljs-number"> 30 </span>ee<span class="hljs-number"> 21 </span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 41 </span>5a<span class="hljs-number"> 17 </span>27 bf 6f<span class="hljs-number"> 70 </span>59 1e 4e<span class="hljs-number"> 60 </span>2d be 4f 
GATT-TX:     1e f9 0d<span class="hljs-number"> 88 </span>e1 d6 c1<span class="hljs-number"> 50 </span>f3<span class="hljs-number"> 51 </span>cc 6d<span class="hljs-number"> 43 </span>d8 
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 04 </span>00 5a d6 cc af<span class="hljs-number"> 78 </span>b3 eb<span class="hljs-number"> 70 </span>e5<span class="hljs-number"> 78 </span>e9 1b 
GATT-RX:    <span class="hljs-number"> 87 </span>fc<span class="hljs-number"> 43 </span>8c b0 ad<span class="hljs-number"> 90 </span>a2 7a 
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 56 </span>a5<span class="hljs-number"> 24 </span>11<span class="hljs-number"> 02 </span>10<span class="hljs-number"> 62 </span>67<span class="hljs-number"> 45 </span>42<span class="hljs-number"> 77 </span>77 3a 7a 
GATT-RX:     ec 3e 8f 2f<span class="hljs-number"> 26 </span>56 4f d3 ba 
Node<span class="hljs-number"> 0100 </span>AppKey Status Success
    NetKey 000, AppKey 001`

将server节点的element 0的sensor server model (0x1100)绑定到app key index =1的app key上

`[config: Target = 0100]<span class="hljs-comment"># bind 0 1 1100</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 cb 2a f4<span class="hljs-number"> 45 </span>0f 4d<span class="hljs-number"> 25 </span>b0<span class="hljs-number"> 47 </span>d8<span class="hljs-number"> 15 </span>72 ba<span class="hljs-number"> 89 </span>
GATT-TX:    <span class="hljs-number"> 61 </span>fc ec<span class="hljs-number"> 15 </span>7e fe 8c dc<span class="hljs-number"> 30 </span>e6<span class="hljs-number"> 04 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4 af<span class="hljs-number"> 08 </span>09 a9<span class="hljs-number"> 12 </span>03 dd fa df 1a 5f e4 7e c1 
GATT-RX:     4f c8<span class="hljs-number"> 58 </span>84<span class="hljs-number"> 82 </span>77 8c<span class="hljs-number"> 62 </span>d1 cb<span class="hljs-number"> 59 </span>f9 
Node<span class="hljs-number"> 0100 </span>Model App Status Success
    Element<span class="hljs-number"> 0100 </span>AppIdx 001
ModelId 1100`
</code></pre>
<p>增加sensor server model (0x1100)订阅发布地址0xc000的信息</p>
<pre><code class="hljs">`[config: Target = 0100]<span class="hljs-comment"># sub-add 0100 c000 1100</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 fe fa<span class="hljs-number"> 07 </span>e1<span class="hljs-number"> 60 </span>7a 1a ac d1<span class="hljs-number"> 26 </span>3a<span class="hljs-number"> 45 </span>8e f7 
GATT-TX:     5e 8e ff<span class="hljs-number"> 79 </span>9d aa<span class="hljs-number"> 90 </span>10 ab b8 ef 
GATT-RX:    <span class="hljs-number"> 00 </span>f4 a8 c7<span class="hljs-number"> 92 </span>53 ee 9e<span class="hljs-number"> 15 </span>c7 fb<span class="hljs-number"> 47 </span>3e e8<span class="hljs-number"> 07 </span>fb 
GATT-RX:     c4 ea 8a f7 2d<span class="hljs-number"> 71 </span>3a<span class="hljs-number"> 33 </span>da<span class="hljs-number"> 12 </span>e9 0f 

Subscription changed for node<span class="hljs-number"> 0100 </span>status: Success
Element Addr:   0100
Subscr Addr:    c000
Model ID:   1100`
</code></pre>
<p>设置sensor server model (0x1100)使用app key index = 1的app key发布信息，发布地址是0xc000，</p>
<pre><code class="hljs">`[config: Target = 0100]<span class="hljs-comment"># pub-set 0100 c000 1 0 0 1100</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 d1 a1<span class="hljs-number"> 54 </span>ee 1b 9f<span class="hljs-number"> 18 </span>4e 3c<span class="hljs-number"> 44 </span>ab<span class="hljs-number"> 57 </span>f9<span class="hljs-number"> 82 </span>
GATT-TX:    <span class="hljs-number"> 73 </span>41 9e 9c ab 3d 5c dd ad<span class="hljs-number"> 27 </span>c3<span class="hljs-number"> 18 </span>b7<span class="hljs-number"> 22 </span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 d0<span class="hljs-number"> 95 </span>d8<span class="hljs-number"> 43 </span>e4<span class="hljs-number"> 87 </span>12<span class="hljs-number"> 96 </span>14 bf<span class="hljs-number"> 52 </span>55 5a 8a 
GATT-TX:     ad<span class="hljs-number"> 00 </span>b0 4c b4<span class="hljs-number"> 46 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 34 </span>4f<span class="hljs-number"> 18 </span>3f cf<span class="hljs-number"> 94 </span>bd<span class="hljs-number"> 90 </span>49 6a 6d 0e<span class="hljs-number"> 83 </span>78 
GATT-RX:     0c b8 7c<span class="hljs-number"> 14 </span>00 7e 3f b6 fa 
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 66 </span>8c<span class="hljs-number"> 52 </span>14 1b f9 b8 e2 d9<span class="hljs-number"> 27 </span>17 0d b0<span class="hljs-number"> 87 </span>
GATT-RX:    <span class="hljs-number"> 28 </span>1a<span class="hljs-number"> 12 </span>65 e6 7f<span class="hljs-number"> 36 </span>b9<span class="hljs-number"> 92 </span>c2 c0<span class="hljs-number"> 79 </span>e8 2d 
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 60 </span>7b 6a a5 b6 9b d4 a2 f0<span class="hljs-number"> 80 </span>5b e6 9e 0b 
GATT-RX:    <span class="hljs-number"> 70 </span>0c c9<span class="hljs-number"> 34 </span>a3<span class="hljs-number"> 65 </span>11 7f 

Set publication for node<span class="hljs-number"> 0100 </span>status: Success
Publication address: 0xc000
Period:<span class="hljs-number"> 0 </span>ms
Retransmit count: 0
Retransmit Interval Steps: 0
GATT-TX:    <span class="hljs-number"> 00 </span>f4 d2 0f fb e4<span class="hljs-number"> 49 </span>24 a0 6c 7d<span class="hljs-number"> 34 </span>a8 bd dc ca 
GATT-TX:     c6 a8 9f<span class="hljs-number"> 17 </span>d0 eb 5b<span class="hljs-number"> 46 </span>31 
[config: Target = 0100]<span class="hljs-comment"># `</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="provisioning和配置client节点"></a><a href="#provisioning和配置client节点" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Provisioning和配置Client节点</h3>
<p>在Raspberry PI上，运行并进入meshctl命令行</p>
<pre><code class="hljs">`pi@raspberrypi:~/bluez-5.48/mesh $ ./meshctl .
Local<span class="hljs-built_in"> config </span>directory <span class="hljs-keyword">not</span> provided.
  netkeys = 1
  appkeys = 2
  provisioners = 1
  provisioned nodes = 1
On/Off<span class="hljs-built_in"> client </span>model: new binding 0001
[NEW] Controller B8:27:EB:B2:E7:4A raspberrypi [default]
[NEW] Device D6:FB:47:4F:7E:A9 AOS Device<span class="hljs-built_in">
Service </span>added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a
Char added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000d:
Char added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service000a/char000b:<span class="hljs-built_in">
Service </span>added /org/bluez/hci0/dev_EC_60_BA_B5_36_D0/service0006`
</code></pre>
<p>client节点上电，并开启发现unprovisioned 设备模式，发现新unprovisioned设备</p>
<pre><code class="hljs">`[meshctl]# discover-unprovisioned on
SetDiscoveryFilter success<span class="hljs-built_in">
Discovery </span>started
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: <span class="hljs-literal">yes</span>
        Mesh Provisioning<span class="hljs-built_in"> Service </span>(00001827-0000-1000-8000-00805f9b34fb)
            Device UUID: dddd0000000000000000000000000000
            OOB: 0000`
</code></pre>
<p>认证该设备</p>
<pre><code class="hljs">`[meshctl]<span class="hljs-comment"># provision dddd</span>
Trying to connect Device D6:FB:47:4F:7E:A9 AOS Device
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: no
Connection successful
Service added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service0006
Service added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a
Char added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000b:
Char added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d:
Services resolved yes
Found matching char: path /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000b, uuid 00002adb-0000-1000-8000-00805f9b34fb
Found matching char: path /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d, uuid 00002adc-0000-1000-8000-00805f9b34fb
Start notification on /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d
Characteristic property changed /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d
AcquireNotify success: fd<span class="hljs-number"> 7 </span>MTU 65
Notify for Mesh Provisioning Out Data started
Open-Node: 0xe51ab0
Open-Prov: 0xe59bf0
Open-Prov: proxy 0xe4c200
Initiated provisioning
Characteristic property changed /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000b
AcquireWrite success: fd<span class="hljs-number"> 8 </span>MTU 65
GATT-TX:    <span class="hljs-number"> 03 </span>00<span class="hljs-number"> 10 </span>
GATT-RX:    <span class="hljs-number"> 03 </span>01<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 01 </span>00<span class="hljs-number"> 00 </span>04<span class="hljs-number"> 00 </span>08<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>
Got provisioning data (12 bytes)
    <span class="hljs-number"> 01 </span>01<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 04 </span>00<span class="hljs-number"> 08 </span>00<span class="hljs-number"> 00 </span>00 
GATT-TX:    <span class="hljs-number"> 03 </span>02<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>
GATT-TX:    <span class="hljs-number"> 03 </span>03<span class="hljs-number"> 86 </span>03 e8 b6<span class="hljs-number"> 50 </span>d7 4d<span class="hljs-number"> 33 </span>e3 fd aa c0 fa<span class="hljs-number"> 46 </span>
GATT-TX:     d5 1c a8<span class="hljs-number"> 58 </span>91 c1 4d de<span class="hljs-number"> 96 </span>30<span class="hljs-number"> 26 </span>8c a0 3c c3 5b 
GATT-TX:     c6<span class="hljs-number"> 87 </span>f4 e9 b9<span class="hljs-number"> 08 </span>a7 e7 2d<span class="hljs-number"> 67 </span>ae 3a 7c f7 1c<span class="hljs-number"> 42 </span>
GATT-TX:     6a da 6d<span class="hljs-number"> 41 </span>ba<span class="hljs-number"> 77 </span>17<span class="hljs-number"> 69 </span>25 a1<span class="hljs-number"> 75 </span>46 e5 eb<span class="hljs-number"> 31 </span>ee 
GATT-TX:    <span class="hljs-number"> 07 </span>5d 
GATT-RX:    <span class="hljs-number"> 43 </span>03<span class="hljs-number"> 26 </span>00<span class="hljs-number"> 86 </span>9a<span class="hljs-number"> 35 </span>54<span class="hljs-number"> 40 </span>b8 be<span class="hljs-number"> 53 </span>a0<span class="hljs-number"> 88 </span>e1<span class="hljs-number"> 55 </span>
GATT-RX:    <span class="hljs-number"> 19 </span>33 ee f4 4d<span class="hljs-number"> 03 </span>35<span class="hljs-number"> 12 </span>59 6d a5<span class="hljs-number"> 63 </span>de a2 0a dc 
GATT-RX:    <span class="hljs-number"> 24 </span>e4 a7 8a 8d<span class="hljs-number"> 42 </span>27<span class="hljs-number"> 76 </span>d8 2c a9<span class="hljs-number"> 87 </span>69<span class="hljs-number"> 27 </span>68<span class="hljs-number"> 61 </span>
GATT-RX:     2b<span class="hljs-number"> 56 </span>f8<span class="hljs-number"> 97 </span>3c a9 bf de b6<span class="hljs-number"> 64 </span>00 f5<span class="hljs-number"> 77 </span>91 
GATT-RX:     c3<span class="hljs-number"> 73 </span>3f<span class="hljs-number"> 94 </span>62 
Got provisioning data (65 bytes)
    <span class="hljs-number"> 03 </span>26<span class="hljs-number"> 00 </span>86 9a<span class="hljs-number"> 35 </span>54<span class="hljs-number"> 40 </span>b8 be<span class="hljs-number"> 53 </span>a0<span class="hljs-number"> 88 </span>e1<span class="hljs-number"> 55 </span>19 
    <span class="hljs-number"> 33 </span>ee f4 4d<span class="hljs-number"> 03 </span>35<span class="hljs-number"> 12 </span>59 6d a5<span class="hljs-number"> 63 </span>de a2 0a dc<span class="hljs-number"> 24 </span>
     e4 a7 8a 8d<span class="hljs-number"> 42 </span>27<span class="hljs-number"> 76 </span>d8 2c a9<span class="hljs-number"> 87 </span>69<span class="hljs-number"> 27 </span>68<span class="hljs-number"> 61 </span>2b 
    <span class="hljs-number"> 56 </span>f8<span class="hljs-number"> 97 </span>3c a9 bf de b6<span class="hljs-number"> 64 </span>00 f5<span class="hljs-number"> 77 </span>91<span class="hljs-number"> 73 </span>3f<span class="hljs-number"> 94 </span>
    <span class="hljs-number"> 62 </span>
Request decimal key (0 - 9999)
[AOS 1m[mesh] Enter Numeric key:`
</code></pre>
<p>查看server命令行OOB输出</p>
<pre><code class="hljs">`Initializing...
Bluetooth initialized
Mesh initialized
OOB Number: <span class="hljs-number">4159</span>`
</code></pre>
<p>在Raspberry PI上键入4159，进行后续provision，后续会打印一长串log</p>
<pre><code class="hljs">`[AOS 1m[mesh] Enter Numeric key: 4159
GATT-TX:    <span class="hljs-number"> 03 </span>05<span class="hljs-number"> 20 </span>2e<span class="hljs-number"> 58 </span>e4 b8<span class="hljs-number"> 06 </span>93 0d a2 b5 2f 7b eb<span class="hljs-number"> 16 </span>
GATT-TX:    <span class="hljs-number"> 99 </span>07 
GATT-RX:    <span class="hljs-number"> 03 </span>05 fd ee fd f5 3d<span class="hljs-number"> 54 </span>71<span class="hljs-number"> 42 </span>91<span class="hljs-number"> 92 </span>64 a4<span class="hljs-number"> 69 </span>46 
GATT-RX:     f7 bc 
Got provisioning data (17 bytes)
    <span class="hljs-number"> 05 </span>fd ee fd f5 3d<span class="hljs-number"> 54 </span>71<span class="hljs-number"> 42 </span>91<span class="hljs-number"> 92 </span>64 a4<span class="hljs-number"> 69 </span>46 f7 
     bc 
GATT-TX:    <span class="hljs-number"> 03 </span>06 e6 4e<span class="hljs-number"> 15 </span>4c<span class="hljs-number"> 75 </span>e4 2d<span class="hljs-number"> 76 </span>d3 0b<span class="hljs-number"> 13 </span>64<span class="hljs-number"> 91 </span>f0 
GATT-TX:     ac e4 
GATT-RX:    <span class="hljs-number"> 03 </span>06<span class="hljs-number"> 54 </span>65<span class="hljs-number"> 35 </span>17 f6 cb<span class="hljs-number"> 77 </span>bc ae af<span class="hljs-number"> 19 </span>8e 7c<span class="hljs-number"> 92 </span>
GATT-RX:    <span class="hljs-number"> 71 </span>f3 
Got provisioning data (17 bytes)
    <span class="hljs-number"> 06 </span>54<span class="hljs-number"> 65 </span>35<span class="hljs-number"> 17 </span>f6 cb<span class="hljs-number"> 77 </span>bc ae af<span class="hljs-number"> 19 </span>8e 7c<span class="hljs-number"> 92 </span>71 
     f3 
Confirmation Validated
S-Key    b4 dc cb 8f 1d<span class="hljs-number"> 62 </span>4e c4<span class="hljs-number"> 95 </span>f5<span class="hljs-number"> 74 </span>6d ff bc<span class="hljs-number"> 42 </span>d9 
S-Nonce <span class="hljs-number"> 54 </span>c1 e5<span class="hljs-number"> 68 </span>cf a6 ec c0<span class="hljs-number"> 47 </span>3b 8f f4<span class="hljs-number"> 25 </span>
DevKey   0c c5<span class="hljs-number"> 26 </span>e9<span class="hljs-number"> 12 </span>e3 d2<span class="hljs-number"> 89 </span>39<span class="hljs-number"> 20 </span>3a af<span class="hljs-number"> 27 </span>a4 f9 d2 
Data    <span class="hljs-number"> 18 </span>ee d9 c2 a5 6a dd<span class="hljs-number"> 85 </span>04 9f fc 3c<span class="hljs-number"> 59 </span>ad 0e<span class="hljs-number"> 12 </span>
Data    <span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 05 </span>01<span class="hljs-number"> 01 </span>
DataEncrypted + mic <span class="hljs-number"> 80 </span>bb ca b9 3f ca ff<span class="hljs-number"> 49 </span>5d<span class="hljs-number"> 22 </span>3c d3 5a<span class="hljs-number"> 70 </span>45<span class="hljs-number"> 61 </span>
DataEncrypted + mic  ae a4 a7 7b b6<span class="hljs-number"> 15 </span>b6 ed df 7c<span class="hljs-number"> 47 </span>8f<span class="hljs-number"> 84 </span>8d d4 dc 
DataEncrypted + mic  db 
GATT-TX:    <span class="hljs-number"> 03 </span>07<span class="hljs-number"> 80 </span>bb ca b9 3f ca ff<span class="hljs-number"> 49 </span>5d<span class="hljs-number"> 22 </span>3c d3 5a<span class="hljs-number"> 70 </span>
GATT-TX:    <span class="hljs-number"> 45 </span>61 ae a4 a7 7b b6<span class="hljs-number"> 15 </span>b6 ed df 7c<span class="hljs-number"> 47 </span>8f<span class="hljs-number"> 84 </span>8d 
GATT-TX:     d4 dc db 
GATT-RX:    <span class="hljs-number"> 03 </span>08 
Got provisioning data (1 bytes)
    <span class="hljs-number"> 08 </span>
Provision success. Assigned Primary Unicast 0101
Attempting to disconnect from D6:FB:47:4F:7E:A9
Characteristic property changed /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d
Write closed
Service added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a
Char added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000b:
Char added /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d:
Services resolved no
SetDiscoveryFilter success
Discovery started
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: yes

        Mesh Proxy Service (00001828-0000-1000-8000-00805f9b34fb)
        Identity for node 0101
Trying to connect to mesh
Adapter property changed 
[CHG] Controller B8:27:EB:B2:E7:4A Discovering: no
Connection successful
Services resolved yes
Found matching char: path /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000b, uuid 00002add-0000-1000-8000-00805f9b34fb
Found matching char: path /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d, uuid 00002ade-0000-1000-8000-00805f9b34fb
Start notification on /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d
Characteristic property changed /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000d
AcquireNotify success: fd<span class="hljs-number"> 7 </span>MTU 65
Notify for Mesh Proxy Out Data started
Trying to open mesh session
GATT-RX:    <span class="hljs-number"> 01 </span>01<span class="hljs-number"> 00 </span>d4<span class="hljs-number"> 76 </span>79<span class="hljs-number"> 43 </span>3f db<span class="hljs-number"> 10 </span>4a<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>05 f4 
GATT-RX:     0a<span class="hljs-number"> 41 </span>fa b0 af<span class="hljs-number"> 32 </span>0b 
iv_upd_state = IV_UPD_NORMAL
Mesh session is open
Characteristic property changed /org/bluez/hci0/dev_D6_FB_47_4F_7E_A9/service000a/char000b
AcquireWrite success: fd<span class="hljs-number"> 8 </span>MTU 65
GATT-TX:    <span class="hljs-number"> 02 </span>f4 8c 6d ef<span class="hljs-number"> 98 </span>ac 2e<span class="hljs-number"> 79 </span>c8 e0 2c<span class="hljs-number"> 83 </span>2b 4a b4 
GATT-TX:     c9 1f e3 a9 
GATT-TX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 95 </span>a2<span class="hljs-number"> 60 </span>a7<span class="hljs-number"> 67 </span>ec a4<span class="hljs-number"> 40 </span>e9<span class="hljs-number"> 18 </span>1a<span class="hljs-number"> 69 </span>a4<span class="hljs-number"> 00 </span>
GATT-TX:     c1<span class="hljs-number"> 54 </span>c7 3d a9 d7 
GATT-RX:    <span class="hljs-number"> 02 </span>f4<span class="hljs-number"> 35 </span>d1 c4<span class="hljs-number"> 66 </span>28<span class="hljs-number"> 17 </span>1b 6d ed<span class="hljs-number"> 86 </span>f9<span class="hljs-number"> 26 </span>19 ca 
GATT-RX:     d5 6f 3c 9e 7b cd 
Proxy Whitelist filter length: 0
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 98 </span>0a<span class="hljs-number"> 63 </span>16<span class="hljs-number"> 58 </span>d9 d6<span class="hljs-number"> 34 </span>75<span class="hljs-number"> 81 </span>6d 7e a3 5f 
GATT-RX:    <span class="hljs-number"> 83 </span>2f 1c<span class="hljs-number"> 58 </span>17 ad<span class="hljs-number"> 23 </span>17 7d 7b<span class="hljs-number"> 50 </span>ee 4e<span class="hljs-number"> 61 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4 cf<span class="hljs-number"> 10 </span>98<span class="hljs-number"> 83 </span>f6 b7<span class="hljs-number"> 13 </span>22<span class="hljs-number"> 45 </span>a0 6b<span class="hljs-number"> 53 </span>1b<span class="hljs-number"> 51 </span>
GATT-RX:     c8<span class="hljs-number"> 35 </span>4b a7 f4 0e f4 f3 d4 c2 0c<span class="hljs-number"> 25 </span>12 ec 
GATT-RX:    <span class="hljs-number"> 00 </span>f4 a3 1e<span class="hljs-number"> 00 </span>1c<span class="hljs-number"> 07 </span>b8 e8 a6 9f<span class="hljs-number"> 29 </span>aa<span class="hljs-number"> 84 </span>7e eb 
GATT-RX:     ee 7a 7c 6b<span class="hljs-number"> 13 </span>63<span class="hljs-number"> 37 </span>ce 
    Composition data for node<span class="hljs-number"> 0101 </span>{
  "cid":"0002",
  "pid":"0000",
  "vid":"0000",
  "crpl":"0005",
  "features":{
    "relay":false,
    "proxy":true,
    "friend":false,
    "lpn":false
  },
  "elements":[
    {
      "elementIndex":0,
      "location":"0000",
      "models":[
        "0000",
        "0001",
        "1102"
      ]
    }
  ]
}
GATT-TX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 71 </span>66 e6<span class="hljs-number"> 89 </span>61<span class="hljs-number"> 44 </span>19 6b c1<span class="hljs-number"> 75 </span>a4 a9 b8 f2 
GATT-TX:     ed 9b b9 ee<span class="hljs-number"> 99 </span>b5<span class="hljs-number"> 96 </span>bc<span class="hljs-number"> 05 </span>`
</code></pre>
<p>上述log分为两个阶段，第一个阶段是利用provisioning connection进行provision，第二个阶段是建立mesh proxy connection，后续需要在这个connection上传输网络配置信息。</p>
<p>当上述log完整打印后，server端会打印provision成功完成的信息</p>
<pre><code class="hljs">`Provisioning completed!
<span class="hljs-symbol">Net ID:</span> <span class="hljs-number">0</span>
<span class="hljs-symbol">Unicast addr:</span> <span class="hljs-number">0</span>x0101`
</code></pre>
<p>接下来，是在刚才建立的mesh proxy connection上传递网络配置信息</p>
<p>首先是进入菜单</p>
<pre><code class="hljs">`[AOS Device-Node-0101]# menu<span class="hljs-built_in"> config
</span>Menu config:
Available commands:
-------------------
target &lt;unicast&gt;                                  <span class="hljs-builtin-name">Set</span> target node <span class="hljs-keyword">to</span> configure
composition-<span class="hljs-builtin-name">get</span> [page_num]                        <span class="hljs-builtin-name">Get</span> Composition Data
netkey-<span class="hljs-builtin-name">add</span> &lt;net_idx&gt;                              <span class="hljs-builtin-name">Add</span><span class="hljs-built_in"> network </span>key
netkey-del &lt;net_idx&gt;                              Delete<span class="hljs-built_in"> network </span>key
appkey-<span class="hljs-builtin-name">add</span> &lt;app_idx&gt;                              <span class="hljs-builtin-name">Add</span> application key
appkey-del &lt;app_idx&gt;                              Delete application key
bind &lt;ele_idx&gt; &lt;app_idx&gt; &lt;mod_id&gt; [cid]           Bind app key <span class="hljs-keyword">to</span> a model
ttl-<span class="hljs-builtin-name">set</span> &lt;ttl&gt;                                     <span class="hljs-builtin-name">Set</span><span class="hljs-built_in"> default </span>TTL
ttl-<span class="hljs-builtin-name">get</span>                                           <span class="hljs-builtin-name">Get</span><span class="hljs-built_in"> default </span>TTL
pub-<span class="hljs-builtin-name">set</span> &lt;ele_addr&gt; &lt;pub_addr&gt; &lt;app_idx&gt; &lt;per (<span class="hljs-keyword">step</span>|res)&gt; &lt;re-xmt (cnt|per)&gt; &lt;mod id&gt; [cid] 
                          <span class="hljs-builtin-name">Set</span> publication
pub-<span class="hljs-builtin-name">get</span> &lt;ele_addr&gt; &lt;model&gt;                        <span class="hljs-builtin-name">Get</span> publication
proxy-<span class="hljs-builtin-name">set</span> &lt;proxy&gt;                                 <span class="hljs-builtin-name">Set</span><span class="hljs-built_in"> proxy </span>state
proxy-<span class="hljs-builtin-name">get</span>                                         <span class="hljs-builtin-name">Get</span><span class="hljs-built_in"> proxy </span>state
ident-<span class="hljs-builtin-name">set</span> &lt;net_idx&gt; &lt;state&gt;                       <span class="hljs-builtin-name">Set</span> node<span class="hljs-built_in"> identity </span>state
ident-<span class="hljs-builtin-name">get</span> &lt;net_idx&gt;                               <span class="hljs-builtin-name">Get</span> node<span class="hljs-built_in"> identity </span>state
relay-<span class="hljs-builtin-name">set</span> &lt;relay&gt; &lt;rexmt count&gt; &lt;rexmt steps&gt;     <span class="hljs-builtin-name">Set</span> relay
relay-<span class="hljs-builtin-name">get</span>                                         <span class="hljs-builtin-name">Get</span> relay
hb-pub-<span class="hljs-builtin-name">set</span> &lt;pub_addr&gt; &lt;count&gt; &lt;period&gt; &lt;features&gt; &lt;net_idx&gt; <span class="hljs-builtin-name">Set</span> heartbeati publish
sub-<span class="hljs-builtin-name">add</span> &lt;ele_addr&gt; &lt;sub_addr&gt; &lt;model id&gt;          Subscription <span class="hljs-builtin-name">add</span>
sub-<span class="hljs-builtin-name">get</span> &lt;ele_addr&gt; &lt;model id&gt;                     Subscription <span class="hljs-builtin-name">get</span>
app-<span class="hljs-builtin-name">get</span> &lt;ele_addr&gt; &lt;model id&gt;                     <span class="hljs-builtin-name">Get</span> App Keys
back                                              Return <span class="hljs-keyword">to</span> main menu
version                                           Display version
quit                                              Quit program
exit                                              Quit program
help                                              Display help about this program`
</code></pre>
<p>选择配置节点，这里可以看到节点ucast addr是0x0101</p>
<pre><code class="hljs">`[AOS Device-<span class="hljs-keyword">Node</span><span class="hljs-title">-0101</span>]<span class="hljs-comment"># target 0101</span>
Configuring <span class="hljs-keyword">node</span> <span class="hljs-title">0101</span>
[config: Target = <span class="hljs-number">0101</span>]<span class="hljs-comment"># target 0101[config: Target = 0101]#`</span>
</code></pre>
<p>配置app key</p>
<pre><code class="hljs">`[config: Target = 0101]<span class="hljs-comment"># target 0101[config: Target = 0101]# appkey-add 1</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 2b<span class="hljs-number"> 37 </span>95<span class="hljs-number"> 64 </span>e7 fe ba<span class="hljs-number"> 41 </span>b3 c8 d9 0c f4 0c 
GATT-TX:    <span class="hljs-number"> 76 </span>36 a4 f0 f9 c4 f8<span class="hljs-number"> 93 </span>73 8a 3d 7d 7e c1 
GATT-TX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 43 </span>6e<span class="hljs-number"> 87 </span>5d<span class="hljs-number"> 09 </span>0b 4b<span class="hljs-number"> 05 </span>a0 1b c0<span class="hljs-number"> 48 </span>da a1 
GATT-TX:     bf d6 9b<span class="hljs-number"> 21 </span>91<span class="hljs-number"> 68 </span>d8 b0 b4<span class="hljs-number"> 27 </span>57<span class="hljs-number"> 90 </span>61<span class="hljs-number"> 06 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4 7f d6 9d<span class="hljs-number"> 40 </span>6d bc<span class="hljs-number"> 10 </span>5f<span class="hljs-number"> 41 </span>67<span class="hljs-number"> 68 </span>56 9c d8 
GATT-RX:     b9<span class="hljs-number"> 77 </span>dc<span class="hljs-number"> 71 </span>b5<span class="hljs-number"> 10 </span>ec b1<span class="hljs-number"> 85 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 81 </span>91 ee<span class="hljs-number"> 63 </span>66 b4 5a<span class="hljs-number"> 42 </span>6f<span class="hljs-number"> 70 </span>f6 d2<span class="hljs-number"> 12 </span>93 
GATT-RX:     2d 9f<span class="hljs-number"> 21 </span>2d fa a3<span class="hljs-number"> 89 </span>2f 4b 
Node<span class="hljs-number"> 0101 </span>AppKey Status Success
    NetKey 000, AppKey 001`
</code></pre>
<p>将client节点的element 0的sensor client model (0x1102)绑定到app key index =1的app key上</p>
<pre><code class="hljs">`[config: Target = 0101]<span class="hljs-comment"># bind 0 1 1102</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4<span class="hljs-number"> 97 </span>c8<span class="hljs-number"> 22 </span>ee 6f<span class="hljs-number"> 11 </span>c3 c6 7c 5c 4f<span class="hljs-number"> 88 </span>e4 3d 
GATT-TX:    <span class="hljs-number"> 36 </span>9e<span class="hljs-number"> 19 </span>c7 3f a8 f3 d3 d4 7d<span class="hljs-number"> 90 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4 e9 e9<span class="hljs-number"> 33 </span>90 5a f3 cb<span class="hljs-number"> 88 </span>c1 3e<span class="hljs-number"> 44 </span>af f6<span class="hljs-number"> 61 </span>
GATT-RX:     d0 ef<span class="hljs-number"> 47 </span>35<span class="hljs-number"> 35 </span>c3<span class="hljs-number"> 03 </span>8a c9<span class="hljs-number"> 43 </span>01 7d 
Node<span class="hljs-number"> 0101 </span>Model App Status Success
    Element<span class="hljs-number"> 0101 </span>AppIdx 001
ModelId 1102`
</code></pre>
<p>增加sensor client model (0x1102)订阅发布地址0xc000的信息</p>
<pre><code class="hljs">`[config: Target = <span class="hljs-number">0101</span>]# <span class="hljs-keyword">sub-add </span><span class="hljs-number">0101</span> c000 <span class="hljs-number">1102</span>
<span class="hljs-symbol">GATT</span>-TX:     <span class="hljs-number">00</span> <span class="hljs-built_in">f4</span> <span class="hljs-built_in">c5</span> <span class="hljs-number">5</span>e <span class="hljs-number">47</span> <span class="hljs-number">70</span> <span class="hljs-number">42</span> <span class="hljs-number">84</span> <span class="hljs-number">3</span>b <span class="hljs-number">28</span> <span class="hljs-number">14</span> <span class="hljs-number">26</span> <span class="hljs-number">60</span> <span class="hljs-number">83</span> <span class="hljs-number">01</span> <span class="hljs-number">69</span> 
<span class="hljs-symbol">GATT</span>-TX:     <span class="hljs-number">7</span>c <span class="hljs-number">25</span> <span class="hljs-built_in">c3</span> <span class="hljs-built_in">c2</span> <span class="hljs-built_in">d9</span> <span class="hljs-number">1</span>d <span class="hljs-built_in">d3</span> fb <span class="hljs-built_in">c0</span> e5 <span class="hljs-number">65</span> 
<span class="hljs-symbol">GATT</span>-RX:     <span class="hljs-number">00</span> <span class="hljs-built_in">f4</span> <span class="hljs-number">6</span>f <span class="hljs-number">71</span> <span class="hljs-number">02</span> <span class="hljs-built_in">d9</span> ec <span class="hljs-number">00</span> cf <span class="hljs-built_in">c1</span> <span class="hljs-number">96</span> <span class="hljs-built_in">f0</span> <span class="hljs-number">3</span>a <span class="hljs-number">7</span>f ea a9 
<span class="hljs-symbol">GATT</span>-RX:     <span class="hljs-keyword">b1 </span>fb <span class="hljs-number">6</span>d <span class="hljs-number">70</span> <span class="hljs-number">31</span> <span class="hljs-number">62</span> <span class="hljs-built_in">d8</span> <span class="hljs-built_in">d0</span> <span class="hljs-number">4</span>b <span class="hljs-number">5</span>d <span class="hljs-number">81</span> a6 

<span class="hljs-keyword">Subscription </span>changed for node <span class="hljs-number">0101</span> status: Success
<span class="hljs-symbol">Element</span> <span class="hljs-keyword">Addr: </span>  <span class="hljs-number">0101</span>
<span class="hljs-keyword">Subscr </span><span class="hljs-keyword">Addr: </span>   c000
<span class="hljs-symbol">Model</span> ID:   <span class="hljs-number">1102</span>`
</code></pre>
<p>设置sensor client model (0x1102)使用app key index = 1的app key发布信息，发布地址是0xc000，</p>
<pre><code class="hljs">`[config: Target = 0101]<span class="hljs-comment"># pub-set 0101 c000 1 0 0 1102</span>
GATT-TX:    <span class="hljs-number"> 00 </span>f4 5a<span class="hljs-number"> 22 </span>c5 d2 d0<span class="hljs-number"> 76 </span>94 a9 7f<span class="hljs-number"> 70 </span>6e<span class="hljs-number"> 64 </span>c1 f3 
GATT-TX:     be<span class="hljs-number"> 58 </span>43 fc f1<span class="hljs-number"> 61 </span>f0 ac dc ce 4d 0b 9c f1 
GATT-TX:    <span class="hljs-number"> 00 </span>f4 1a 8a af<span class="hljs-number"> 58 </span>92 d2 d5<span class="hljs-number"> 38 </span>b2 0f<span class="hljs-number"> 62 </span>56<span class="hljs-number"> 34 </span>96 
GATT-TX:     5f<span class="hljs-number"> 08 </span>9e 5a c6<span class="hljs-number"> 54 </span>
GATT-RX:    <span class="hljs-number"> 00 </span>f4 eb<span class="hljs-number"> 12 </span>ea 4f 6f 1f f8 e6 f2<span class="hljs-number"> 92 </span>c4 d7<span class="hljs-number"> 82 </span>a0 
GATT-RX:     ad 9e c9<span class="hljs-number"> 92 </span>9e<span class="hljs-number"> 91 </span>d4 a6 3c 
GATT-RX:    <span class="hljs-number"> 00 </span>f4 2a<span class="hljs-number"> 11 </span>82 c6<span class="hljs-number"> 86 </span>27 0a 4a<span class="hljs-number"> 88 </span>bf a6<span class="hljs-number"> 02 </span>74<span class="hljs-number"> 56 </span>
GATT-RX:     d5 2d<span class="hljs-number"> 28 </span>72<span class="hljs-number"> 24 </span>cd ae<span class="hljs-number"> 91 </span>fa dc<span class="hljs-number"> 72 </span>35 d7 be 
GATT-RX:    <span class="hljs-number"> 00 </span>f4 a7<span class="hljs-number"> 08 </span>14 6c<span class="hljs-number"> 95 </span>bd<span class="hljs-number"> 62 </span>07<span class="hljs-number"> 67 </span>1b c6 c8<span class="hljs-number"> 95 </span>b8 
GATT-RX:     f2 a9 3b<span class="hljs-number"> 03 </span>d2<span class="hljs-number"> 82 </span>d1<span class="hljs-number"> 97 </span>

Set publication for node<span class="hljs-number"> 0101 </span>status: Success
Publication address: 0xc000
Period:<span class="hljs-number"> 0 </span>ms
Retransmit count: 0
Retransmit Interval Steps: 0
GATT-TX:    <span class="hljs-number"> 00 </span>f4 f0<span class="hljs-number"> 60 </span>6a<span class="hljs-number"> 70 </span>db 3b e2<span class="hljs-number"> 60 </span>a6 c8<span class="hljs-number"> 50 </span>d9<span class="hljs-number"> 03 </span>36 
GATT-TX:     d5 a1<span class="hljs-number"> 47 </span>c9 2f<span class="hljs-number"> 25 </span>49 5e 47`
</code></pre>
<p>上述配置全部完成后，可以在client节点看到周期性发送温度请求信息和收到回复的log</p>
<pre><code class="hljs">`Sensor status Get request sent <span class="hljs-keyword">with</span> OpCode <span class="hljs-number">0x00008231</span>
Got the sensor status 
Sensor ID: <span class="hljs-number">0x2a1f</span>
Temperature value: <span class="hljs-number">27</span>`
</code></pre>
<p>在server节点可以看到周期性接收到温度请求和发送回复的log</p>
<pre><code class="hljs">`Sensor Status Get request received
Sensor status sent <span class="hljs-keyword">with</span> OpCode <span class="hljs-number">0x00000052</span>`
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav docOnPageNav"><ul class="toc-headings"><li><a href="#硬件准备">硬件准备</a></li><li><a href="#软件环境搭建">软件环境搭建</a><ul class="toc-headings"><li><a href="#raspberry-pi-kernel">Raspberry PI kernel</a></li><li><a href="#json-c">json-c</a></li><li><a href="#bluez">Bluez</a></li><li><a href="#bluetooth-controller">Bluetooth controller</a></li><li><a href="#server端和client端应用程序">Server端和Client端应用程序</a></li></ul></li><li><a href="#温度监测网络的搭建">温度监测网络的搭建</a><ul class="toc-headings"><li><a href="#provisioning和配置server节点">Provisioning和配置Server节点</a></li><li><a href="#provisioning和配置client节点">Provisioning和配置Client节点</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/docs/Getting-Started" style="margin:20px"><img src="/img/logo.png" alt="AliOS-Things" width="100"/></a><div><h5>Docs</h5><a href="/docs/en/Getting-Started.html">Getting Started</a><a href="/docs/en/Linkkit-Tutorial.html">Guides</a><a href="/docs/en/api-reference/AliOS-Things-API-Guide.html">API Reference</a></div><div><h5>Community</h5><a href="/en/users.html">dingding</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">WebChart</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Yunqi</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 AliOS-Things</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: 'my-api-key',
                indexName: 'my-index-name',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>